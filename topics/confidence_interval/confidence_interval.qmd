# Confidence Interval {background-color="#e98300"}

## Testing hypothesis with CI's

Using confidence intervals to test hypotheses is a common practice in scientific research.

We can use this knowledge to test hypotheses. If the confidence interval does not contain the null hypothesis value, the null hypothesis can be rejected.

> **Note** that this is not the same as our decision rule for NHST. In NHST, we compare the p-value to the alpha level. In the case of the confidence interval, we compare the confidence interval to the null hypothesis value.

## Standard Error

> 95% confidence interval

$$SE = \frac{\text{Standard deviation}}{\text{Square root of sample size}} = \frac{s}{\sqrt{n}}$$

- Lowerbound = $\bar{x} - 1.96 \times SE$
- Upperbound = $\bar{x} + 1.96 \times SE$

![](https://upload.wikimedia.org/wikipedia/commons/3/3a/Standard_deviation_diagram_micro.svg){.absolute bottom=0 right=50 height="220" .fragment}

## Candy weight example

```{r, fig.height=3, fig.width=6, echo=FALSE}
cw   = rnorm(46, 7, 2)
mcw  = mean(cw)
sdcw = sd(cw)
ncw  = length(cw)
se   = sdcw/sqrt(ncw)
lb   = mcw - 1.96 * se
ub   = mcw + 1.96 * se

plot(cw, 0*cw+1, 
     xlim = c(0,15), 
     ylim = c(.8,1.2), 
     ylab = "", 
     xlab = "Candy weight",
     yaxt = "n",
     cex  = 2,
     col  = rgb(0,0,0,.5))

# population value of candy weight is 5.5
abline(v=5.5, col="red", lwd=2)
text(5.5, .85, "Hypothesis value 5.5", col="red", pos=4)

# average and and standard error
text(mcw, 1.1, paste("m =", round(mcw,2), "se =", round(se,2)), pos=4, col="blue")

segments(lb, 1, ub, 1, lwd=4, col="blue")
# lb
segments(lb, 1.05, lb, .95, lwd=2, col="blue")
text(lb, .92, paste("LB =", round(lb,2)), col="blue", pos=2, cex = .8)
# ub
segments(ub, 1.05, ub, .95, lwd=2, col="blue")
text(ub, .92, paste("UB =", round(ub,2)), col="blue", pos=4, cex = .8)



```


## Plot CI


```{r, echo=FALSE}
mean_x1 = 5;
mean_x2 = 7;
  sd_x1 = 2.6;
  sd_x2 = 2.7;
   n_x1 = c(5,10,20,50,100);
   n_x2 = c(5,10,20,50,100);


barplot(c(mean_x1,mean_x2),
        names.arg = c("Group 1","Group 2"),
        col       = "lightblue",
        ylim      = c(0,11),
        ylab      = "Mean",
        xlab      = "Groups",
        main      = "Mean and 95% CI")

text(.4, 9, labels="Sample size:")

for(i in 1:5) {
  
x.1.position = c(.3, .5, .7, .9, 1.1)
x.2.position = c(1.5, 1.7, 1.9, 2.1, 2.3)
  
se_x1 = sd_x1/sqrt(n_x1[i]);
se_x2 = sd_x2/sqrt(n_x2[i]);
  
segments(x.1.position[i],mean_x1-se_x1*1.96,
         x.1.position[i],mean_x1+se_x1*1.96,
         lwd=2)

segments(x.1.position[i]-.07,mean_x1-se_x1*1.96,x.1.position[i]+.07,mean_x1-se_x1*1.96,lwd=2)
segments(x.1.position[i]-.07,mean_x1+se_x1*1.96,x.1.position[i]+.07,mean_x1+se_x1*1.96,lwd=2)

text(x.1.position[i], mean_x1+se_x1*1.96+.7, labels=n_x1[i])

segments(x.2.position[i],mean_x2-se_x2*1.96,
         x.2.position[i],mean_x2+se_x2*1.96,
         lwd=2)

segments(x.2.position[i]-.07,mean_x2-se_x2*1.96,x.2.position[i]+.07,mean_x2-se_x2*1.96,lwd=2)
segments(x.2.position[i]-.07,mean_x2+se_x2*1.96,x.2.position[i]+.07,mean_x2+se_x2*1.96,lwd=2)

text(x.2.position[i], mean_x2+se_x2*1.96+.7, labels=n_x1[i])

}
```



## 5 out of 100 samples

```{r, echo=FALSE, out.height=600}
set.seed(1548)

x  = seq(-4,4,.05) # sequence x values for normal distribution
hx = dnorm(x)      # calculate y values

title = expression(atop("SAMPLES FROM NORMAL DISTRIBUTION",paste(mu," falls within the CI in ~95% of the samples")))

plot(x,hx+1,type="l",ylim=c(0,1.45),xlim=c(-4,9), yaxt="n", xaxt="n",ylab="",xlab="",main=title, mai=c(3,1,2,1),mar=c(3,1,2,1))

# Add red area
polygon(c(x,rev(x)),c(rep(1,length(x)),hx+1),col="red",lty=1)

# Add mu line
lines(c(0,0),c(0,max(hx)+1))

# Add mu symbol to x axis
axis( 1,at=0,labels=expression(mu), cex=2 )

# Create curly braces for normal distribution 
ybracket = seq(1,max(hx)+1,length=39)
xbracket = rep(4.1,39)*c(c(1,1.02),rep(1.03,16),c(1.04,1.05,1.04),rep(1.03,16),c(1.02,1))

lines(xbracket,ybracket,col="black")

# Create curly braces for samples
ybracket = seq(0,1,length=39)
xbracket = rep(4.1,39)*c(c(1,1.02),rep(1.03,16),c(1.04,1.05,1.04),rep(1.03,16),c(1.02,1))

lines(xbracket,ybracket,col="black")

text = expression(atop("Normally distributed","population"))

text(4.1*1.06,1+(max(hx)/2), text,pos=4)

text = expression(atop("95% Confidence interval","in 100 samples","drawn from the","normal distribution"))

text(4.1*1.06,.5, text,pos=4)

# Add confidence intervals

mu  = 0
sig = 1

mu_in_ci = array() # create empty array

iterations = 100

for(i in 1:iterations) {
	
	n      = round(runif(1,10,60)) # use variable sample sizes between 10 and 60
	sample = rnorm(n,mu,sig)       # sample from normal distribution
	
	sample_mean = mean(sample)
	sample_sd   = sd(sample)
	sample_ci   = sample_sd/sqrt(n)

	sample_ci_upperbound = sample_mean + sample_ci * 1.96
	sample_ci_lowerbound = sample_mean - sample_ci * 1.96
	
	if(sample_ci_lowerbound < mu & sample_ci_upperbound > mu) {
		
		mu_in_ci[i] = 1	
		col = "darkgrey"	
		}
	else {
		mu_in_ci[i] = 0
		col = "red"
		}
    
    # plot CI lines
    lines(c(sample_ci_lowerbound,sample_ci_upperbound),rep((.98/iterations)*i,2),col=col)

	}
	
percentage = (1/iterations)*sum(mu_in_ci)
```

## Common Misinterpretations

Confidence intervals and levels are frequently misunderstood, and published studies have shown that even professional scientists often misinterpret them [@wiki:Confidence_interval]

@hoekstra2014robust administerred the following questionair to 120 researchers.

## {.smaller}

:::: {.columns}

::: {.column width="70%"}
![](https://media.springernature.com/full/springer-static/image/art%3A10.3758%2Fs13423-013-0572-3/MediaObjects/13423_2013_572_Figa_HTML.gif){fig-align="center"}
:::

::: {.column width="30%"}

:::: {.fragment}

::: {.callout-important}
All of the statements are false
:::

::::

:::

::::

## Researcher don't know {.smaller}

| #True | First-Year Students (n = 442) | Master Students (n = 34) | Researchers (n = 118) |
|--------|-------------------------------|--------------------------|-----------------------|
| 0      | 2%                            | 0%                       | 3%                    |
| 1      | 6%                            | 24%                      | 9%                    |
| 2      | 14%                           | 18%                      | 14%                   |
| 3      | 26%                           | 15%                      | 25%                   |
| 4      | 30%                           | 12%                      | 22%                   |
| 5      | 15%                           | 21%                      | 16%                   |
| 6      | 7%                            | 12%                      | 11%                   |

: Table 2 from @hoekstra2014robust

