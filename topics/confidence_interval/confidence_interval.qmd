# Confidence Interval

The confidence interval is a range of values that is likely to contain the true value of an unknown population parameter. The confidence interval is calculated from a given set of sample data. The confidence interval is used to express the uncertainty associated with a sample estimate of a population parameter.

We use the standard error to calculate the lower and upper limit of the confidence interval.

## Standard Error

> 95% confidence interval

$$SE = \frac{\text{Standard deviation}}{\text{Square root of sample size}} = \frac{s}{\sqrt{n}}$$

- Lowerbound = $\bar{x} - 1.96 \times SE$
- Upperbound = $\bar{x} + 1.96 \times SE$

## Plot CI


```{r, echo=FALSE}
mean_x1 = 5;
mean_x2 = 7;
  sd_x1 = 2.6;
  sd_x2 = 2.7;
   n_x1 = c(5,10,20,50,100);
   n_x2 = c(5,10,20,50,100);


barplot(c(mean_x1,mean_x2),
        names.arg = c("Group 1","Group 2"),
        col       = "lightblue",
        ylim      = c(0,11),
        ylab      = "Mean",
        xlab      = "Groups",
        main      = "Mean and 95% CI")

text(.4, 9, labels="Sample size:")

for(i in 1:5) {
  
x.1.position = c(.3, .5, .7, .9, 1.1)
x.2.position = c(1.5, 1.7, 1.9, 2.1, 2.3)
  
se_x1 = sd_x1/sqrt(n_x1[i]);
se_x2 = sd_x2/sqrt(n_x2[i]);
  
segments(x.1.position[i],mean_x1-se_x1*1.96,
         x.1.position[i],mean_x1+se_x1*1.96,
         lwd=2)

segments(x.1.position[i]-.07,mean_x1-se_x1*1.96,x.1.position[i]+.07,mean_x1-se_x1*1.96,lwd=2)
segments(x.1.position[i]-.07,mean_x1+se_x1*1.96,x.1.position[i]+.07,mean_x1+se_x1*1.96,lwd=2)

text(x.1.position[i], mean_x1+se_x1*1.96+.7, labels=n_x1[i])

segments(x.2.position[i],mean_x2-se_x2*1.96,
         x.2.position[i],mean_x2+se_x2*1.96,
         lwd=2)

segments(x.2.position[i]-.07,mean_x2-se_x2*1.96,x.2.position[i]+.07,mean_x2-se_x2*1.96,lwd=2)
segments(x.2.position[i]-.07,mean_x2+se_x2*1.96,x.2.position[i]+.07,mean_x2+se_x2*1.96,lwd=2)

text(x.2.position[i], mean_x2+se_x2*1.96+.7, labels=n_x1[i])

}
```



## 5 out of 100 samples

```{r, echo=FALSE, out.height=600}
set.seed(1548)

x  = seq(-4,4,.05) # sequence x values for normal distribution
hx = dnorm(x)      # calculate y values

title = expression(atop("SAMPLES FROM NORMAL DISTRIBUTION",paste(mu," falls within the CI in ~95% of the samples")))

plot(x,hx+1,type="l",ylim=c(0,1.45),xlim=c(-4,9), yaxt="n", xaxt="n",ylab="",xlab="",main=title, mai=c(3,1,2,1),mar=c(3,1,2,1))

# Add red area
polygon(c(x,rev(x)),c(rep(1,length(x)),hx+1),col="red",lty=1)

# Add mu line
lines(c(0,0),c(0,max(hx)+1))

# Add mu symbol to x axis
axis( 1,at=0,labels=expression(mu), cex=2 )

# Create curly braces for normal distribution 
ybracket = seq(1,max(hx)+1,length=39)
xbracket = rep(4.1,39)*c(c(1,1.02),rep(1.03,16),c(1.04,1.05,1.04),rep(1.03,16),c(1.02,1))

lines(xbracket,ybracket,col="black")

# Create curly braces for samples
ybracket = seq(0,1,length=39)
xbracket = rep(4.1,39)*c(c(1,1.02),rep(1.03,16),c(1.04,1.05,1.04),rep(1.03,16),c(1.02,1))

lines(xbracket,ybracket,col="black")

text = expression(atop("Normally distributed","population"))

text(4.1*1.06,1+(max(hx)/2), text,pos=4)

text = expression(atop("95% Confidence interval","in 100 samples","drawn from the","normal distribution"))

text(4.1*1.06,.5, text,pos=4)

# Add confidence intervals

mu  = 0
sig = 1

mu_in_ci = array() # create empty array

iterations = 100

for(i in 1:iterations) {
	
	n      = round(runif(1,10,60)) # use variable sample sizes between 10 and 60
	sample = rnorm(n,mu,sig)       # sample from normal distribution
	
	sample_mean = mean(sample)
	sample_sd   = sd(sample)
	sample_ci   = sample_sd/sqrt(n)

	sample_ci_upperbound = sample_mean + sample_ci * 1.96
	sample_ci_lowerbound = sample_mean - sample_ci * 1.96
	
	if(sample_ci_lowerbound < mu & sample_ci_upperbound > mu) {
		
		mu_in_ci[i] = 1	
		col = "darkgrey"	
		}
	else {
		mu_in_ci[i] = 0
		col = "red"
		}
    
    # plot CI lines
    lines(c(sample_ci_lowerbound,sample_ci_upperbound),rep((.98/iterations)*i,2),col=col)

	}
	
percentage = (1/iterations)*sum(mu_in_ci)
```

## Common Misinterpretations

Confidence intervals and levels are frequently misunderstood, and published studies have shown that even professional scientists often misinterpret them [@wiki:Confidence_interval]

@hoekstra2014robust administerred the following questionair to 120 researchers.

##

:::: {.columns}

::: {.column width="60%"}
![](https://media.springernature.com/full/springer-static/image/art%3A10.3758%2Fs13423-013-0572-3/MediaObjects/13423_2013_572_Figa_HTML.gif){fig-align="center"}
:::

::: {.column width="40%"}

:::: {.fragment}

::: {.callout-important}
All of the statements are false
:::

::::

:::

::::

## Researcher don't know {.smaller}

| Number | First-Year Students (n = 442) | Master Students (n = 34) | Researchers (n = 118) |
|--------|-------------------------------|--------------------------|-----------------------|
| 0      | 2%                            | 0%                       | 3%                    |
| 1      | 6%                            | 24%                      | 9%                    |
| 2      | 14%                           | 18%                      | 14%                   |
| 3      | 26%                           | 15%                      | 25%                   |
| 4      | 30%                           | 12%                      | 22%                   |
| 5      | 15%                           | 21%                      | 16%                   |
| 6      | 7%                            | 12%                      | 11%                   |

: Table 2 from @hoekstra2014robust

## CI compare to H0

